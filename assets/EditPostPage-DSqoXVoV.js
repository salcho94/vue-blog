import{d as Q,I as X,H as z,l as G,r as d,c as Y,o as Z,O as ee,b as o,e as s,g as F,t as u,f as g,v as h,Q as te,F as m,h as T,S as ae,i as f,V as R,W as U,u as se,L as le,X as re,q as n,U as oe}from"./index-Ca8rvWVr.js";import{u as ne}from"./upload-B7hhaLRr.js";import{M as ie}from"./index-BMSQkwth.js";import"./index-B9ygI19o.js";const de={class:"max-w-3xl mx-auto space-y-4"},ue={key:0,class:"text-xs text-slate-500"},pe={key:1,class:"text-xs text-red-400"},ve={key:2,class:"grid gap-3 text-[12px]"},ce={class:"grid gap-1"},ge={class:"grid gap-1"},me={class:"grid gap-1"},fe=["value"],be={class:"grid gap-1"},xe={class:"flex items-center gap-2 text-[11px]"},ye=["disabled"],ke={class:"mt-2 border border-slate-200 dark:border-slate-700 rounded-md p-3 bg-white dark:bg-slate-900"},he={class:"flex items-center justify-between mb-2"},we={class:"flex items-center gap-2"},_e=["innerHTML"],Se={class:"grid gap-2"},Ie={class:"flex flex-wrap gap-1.5"},Te=["onClick"],Ce=["onKeydown","onKeyup"],Pe={key:0,class:"rounded-md border border-slate-200 dark:border-slate-800 p-3 bg-slate-50 dark:bg-slate-900/50"},Ve={class:"list-disc pl-5 space-y-0.5 text-[11px]"},Me={class:"flex items-center gap-2 pt-1"},Je=["disabled"],Ue=Q({__name:"EditPostPage",setup(Ne){const B=G(),C=le(),P=X(),v=z(),w=B.params.id,r=d(null),t=d(null),V=d(!0),b=d(!1),p=d(""),D=["Java","TypeScript","JavaScript","React","Vue","Other","여행"],M=d(null),x=d(!1),J=d(null),K=new ie({breaks:!0}),N=d(""),y=d(!0),_=()=>{N.value=K.render(t.value?.content||"")},A=l=>{if(!t.value)return;const e=J.value,a=t.value.content||"",i=`

![image](${l})
`;if(e){const c=e.selectionStart??a.length,I=e.selectionEnd??c;t.value.content=a.slice(0,c)+i+a.slice(I),oe(()=>{const q=c+i.length;e.selectionStart=e.selectionEnd=q})}else t.value.content=a+i;_()},O=async l=>{try{x.value=!0,p.value="";const e=await ne(l);A(e)}catch(e){const a=e?.message||"이미지 업로드 실패";p.value=a,v.alert({title:"이미지 업로드 오류",message:a,type:"error"})}finally{x.value=!1}},H=()=>{M.value?.click()},L=async l=>{const e=l.target,a=e.files?.[0];a&&(await O(a),e.value="")},$=async l=>{const e=l.clipboardData;if(!e)return;const i=Array.from(e.items).find(I=>I.type.startsWith("image/"));if(!i)return;const c=i.getAsFile();c&&(l.preventDefault(),await O(c))},k=d("");function S(){const l=k.value.trim();!l||!t.value||(l.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{t.value.tags||(t.value.tags=[]),t.value.tags.includes(e)||t.value.tags.push(e)}),k.value="")}function j(l){t.value?.tags&&(t.value.tags=t.value.tags.filter(e=>e!==l))}const E=Y(()=>{if(!r.value||!t.value)return[];const l=[],e=(a,i)=>JSON.stringify(a)!==JSON.stringify(i);return e(r.value.title||"",t.value.title||"")&&l.push({field:"제목",before:r.value.title||"",after:t.value.title||""}),e(r.value.summary||"",t.value.summary||"")&&l.push({field:"요약",before:r.value.summary||"",after:t.value.summary||""}),e(r.value.category||"",t.value.category||"")&&l.push({field:"카테고리",before:r.value.category||"",after:t.value.category||""}),e(r.value.content||"",t.value.content||"")&&l.push({field:"본문",before:"…",after:"…"}),e(r.value.tags||[],t.value.tags||[])&&l.push({field:"태그",before:r.value.tags||[],after:t.value.tags||[]}),e(!!r.value.isPublished,!!t.value.isPublished)&&l.push({field:"공개 여부",before:!!r.value.isPublished,after:!!t.value.isPublished}),l});Z(async()=>{try{const l=await ee(w);if(!l){const e="포스트를 찾을 수 없습니다.";p.value=e,v.alert({title:"불러오기 오류",message:e,type:"error"});return}if(!P.user||P.user.uid!==l.authorId){const e="수정 권한이 없습니다.";p.value=e,v.alert({title:"권한 오류",message:e,type:"error"});return}r.value=JSON.parse(JSON.stringify(l)),t.value=JSON.parse(JSON.stringify(l)),t.value.tags||(t.value.tags=[]),t.value.category||(t.value.category="Java"),_()}catch(l){const e=l?.message||"불러오기 실패";p.value=e,v.alert({title:"불러오기 오류",message:e,type:"error"})}finally{V.value=!1}});async function W(){if(!t.value)return;const l=t.value.title?.trim()||"",e=t.value.content?.trim()||"";if(!l||!e){v.alert({title:"작성 오류",message:"제목과 내용을 모두 입력하세요.",type:"error"});return}if(!t.value.category){v.alert({title:"카테고리 선택",message:"카테고리를 선택해주세요.",type:"error"});return}b.value=!0,p.value="";try{await re(w,{title:l,summary:t.value.summary?.trim()||"",content:t.value.content,tags:(t.value.tags||[]).map(a=>a.trim()).filter(Boolean),category:t.value.category,isPublished:!!t.value.isPublished}),window.dispatchEvent(new CustomEvent("posts-updated")),v.alert({title:"저장 완료",message:"글이 성공적으로 수정되었습니다.",type:"success"}),C.push({name:"post-detail",params:{id:w}})}catch(a){const i=a?.message||"수정 실패";p.value=i,v.alert({title:"수정 실패",message:i,type:"error"})}finally{b.value=!1}}return(l,e)=>(n(),o("div",de,[e[17]||(e[17]=s("h1",{class:"text-xl font-semibold text-slate-900 dark:text-slate-100"}," 글 수정 ",-1)),V.value?(n(),o("div",ue,"loading...")):p.value?(n(),o("div",pe,u(p.value),1)):t.value?(n(),o("div",ve,[s("label",ce,[e[8]||(e[8]=s("span",{class:"text-slate-500"},"제목",-1)),g(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.title=a),placeholder:"제목을 입력하세요",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[h,t.value.title]])]),s("label",ge,[e[9]||(e[9]=s("span",{class:"text-slate-500"},"요약",-1)),g(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.summary=a),placeholder:"요약(메타/리스트 미리보기)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[h,t.value.summary]])]),s("label",me,[e[10]||(e[10]=s("span",{class:"text-slate-500"},"카테고리",-1)),g(s("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.category=a),class:"w-full max-w-xs rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},[(n(),o(m,null,T(D,a=>s("option",{key:a,value:a},u(a),9,fe)),64))],512),[[te,t.value.category]])]),s("label",be,[e[13]||(e[13]=s("span",{class:"text-slate-500"},"본문",-1)),s("div",xe,[s("button",{type:"button",onClick:H,disabled:x.value,class:"px-3 py-1.5 rounded-md border border-slate-300 text-slate-700 dark:text-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-60"},u(x.value?"이미지 업로드 중…":"이미지 추가"),9,ye),e[11]||(e[11]=s("span",{class:"text-[10px] text-slate-400"}," 업로드하면 본문에 이미지 마크다운이 자동으로 추가됩니다. ",-1)),s("input",{ref_key:"fileInputRef",ref:M,type:"file",accept:"image/*",class:"hidden",onChange:L},null,544)]),g(s("textarea",{ref_key:"contentTextareaRef",ref:J,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.content=a),rows:"12",placeholder:"내용을 입력하세요 (마크다운 지원, 예: # 제목)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-3 font-mono text-[12px]",onPaste:$},null,544),[[h,t.value.content]]),s("div",ke,[s("div",he,[e[12]||(e[12]=s("div",{class:"text-[10px] text-slate-400"}," 미리보기 ",-1)),s("div",we,[s("button",{type:"button",onClick:_,class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"}," 새로고침 "),s("button",{type:"button",onClick:e[4]||(e[4]=a=>y.value=!y.value),class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"},u(y.value?"접기":"열기"),1)])]),g(s("div",{class:"prose prose-sm max-w-none dark:prose-invert",innerHTML:N.value},null,8,_e),[[ae,y.value]])])]),s("div",Se,[e[14]||(e[14]=s("span",{class:"text-slate-500"},"태그",-1)),s("div",Ie,[(n(!0),o(m,null,T(t.value.tags,a=>(n(),o("span",{key:a,class:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-200 text-[11px]"},[f(" #"+u(a)+" ",1),s("button",{class:"ml-1 text-slate-500 hover:text-red-500",onClick:i=>j(a),title:"remove"}," ✕ ",8,Te)]))),128))]),g(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),onKeydown:R(U(S,["prevent"]),["enter"]),onKeyup:R(U(S,["prevent"]),["enter"]),placeholder:"엔터/콤마로 추가 (예: Vue, Firebase)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]",onInput:e[6]||(e[6]=a=>{a.data===","&&S()})},null,40,Ce),[[h,k.value]]),e[15]||(e[15]=s("p",{class:"text-[11px] text-slate-400"},[f(" 예시: "),s("code",null,"Vue, Firebase, Tailwind")],-1))]),E.value.length?(n(),o("div",Pe,[e[16]||(e[16]=s("div",{class:"text-[12px] font-medium mb-1"},"변경사항",-1)),s("ul",Ve,[(n(!0),o(m,null,T(E.value,a=>(n(),o("li",{key:a.field},[s("strong",null,u(a.field),1),a.field!=="본문"&&a.field!=="태그"?(n(),o(m,{key:0},[f(" : “"+u(a.before)+"” → “"+u(a.after)+"” ",1)],64)):a.field==="태그"?(n(),o(m,{key:1},[f(" : "+u(a.before.join(", ")||"없음")+" → "+u(a.after.join(", ")||"없음"),1)],64)):(n(),o(m,{key:2},[f(" (내용 변경) ")],64))]))),128))])])):F("",!0),s("div",Me,[s("button",{onClick:W,disabled:b.value,class:"px-4 py-2 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 disabled:opacity-60 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300"},u(b.value?"저장 중…":"저장"),9,Je),s("button",{type:"button",class:"px-3 py-2 rounded-md text-[12px] border border-slate-300 dark:border-slate-700",onClick:e[7]||(e[7]=a=>se(C).back())}," 취소 ")])])):F("",!0)]))}});export{Ue as default};
