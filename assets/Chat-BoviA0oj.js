import{d as ne,r as d,Z as ie,c as de,w as K,o as ce,a as ue,b as o,e as t,g as x,$ as pe,t as u,n as ve,F as U,h as $,a0 as me,f as be,v as fe,i as xe,q as n}from"./index-Ca8rvWVr.js";import{a as he}from"./index-B9ygI19o.js";const ge={class:"flex flex-col min-h-screen sm:min-h-[500px] max-h-screen rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 shadow-sm overflow-hidden"},ke={class:"bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-50 border-b border-slate-200 dark:border-slate-800"},ye={class:"flex items-center justify-between px-3 py-2"},_e={class:"flex items-center gap-3"},we={class:"hidden md:flex items-center text-[11px] bg-slate-100 dark:bg-slate-800 rounded-md px-1.5 py-0.5 border border-slate-200 dark:border-slate-700"},Se={class:"px-1 tabular-nums text-slate-700 dark:text-slate-200"},Ne={class:"flex flex-col items-end text-[10px]"},Ce={class:"flex items-center gap-1 text-slate-600 dark:text-slate-300"},Re={class:"flex items-center gap-1 text-slate-500 dark:text-slate-300 mt-0.5"},Ee={class:"font-semibold px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-100"},Le={class:"flex-1 bg-white dark:bg-slate-950"},Oe={class:"h-full overflow-y-auto"},Ie={class:"px-2 py-1 border-r border-slate-100 dark:border-slate-800 text-slate-500 dark:text-slate-400"},Ue={class:"px-2 py-1 border-r border-slate-100 dark:border-slate-800 font-semibold flex items-center gap-1"},$e={key:0,class:"text-blue-500"},Ae={key:1,class:"text-slate-800 dark:text-slate-100"},Te={key:2,class:"text-[10px] text-emerald-600 dark:text-emerald-400"},De={class:"px-2 py-1 col-span-4 whitespace-pre-wrap break-words text-slate-800 dark:text-slate-100"},Fe={key:0},Me={key:1,class:"mt-1 flex flex-wrap gap-2"},je=["src","alt"],ze=["href"],Pe={key:0,class:"bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 p-2"},We={class:"flex flex-wrap gap-2"},Be={key:0,class:"relative"},Ve=["src","alt"],Je=["onClick"],Ke={key:1,class:"relative bg-white dark:bg-slate-950 px-2 py-1.5 rounded border border-slate-200 dark:border-slate-700 max-w-[140px] flex items-center gap-1"},qe={class:"text-[11px] truncate text-slate-800 dark:text-slate-100"},Xe=["onClick"],Ze={key:1,class:"text-[11px] text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900 px-2 py-1 border-t border-slate-200 dark:border-slate-800"},Ge={class:"border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900 p-2"},He={class:"flex items-end gap-2"},Qe={class:"mt-1 flex items-center gap-2 text-[10px] text-slate-500 dark:text-slate-400"},Ye={class:"truncate"},et={class:"font-semibold text-slate-800 dark:text-slate-100"},tt={key:0,class:"ml-auto"},st={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},at={class:"bg-white dark:bg-slate-950 rounded-xl shadow-lg p-4 w-72 border border-slate-200 dark:border-slate-700"},rt={class:"font-bold mb-2 text-sm text-slate-900 dark:text-slate-50"},lt={class:"text-xs mb-4 whitespace-pre-line text-slate-700 dark:text-slate-200"},ot="wss://salchoserver.n-e.kr/ws/chat",nt="https://salchoserver.n-e.kr/blog/upload",it="https://salchoserver.n-e.kr",k="99999",q="ë°ì´í„° ë¶„ì„ ì‹œíŠ¸",ut=ne({__name:"Chat",props:{theme:{},userNickName:{}},setup(X){const A=["ì‚¬ìš©ì","ë°ì´í„°","ë¶„ì„","ì‹œíŠ¸","ìœ ì €"],y=X,C=()=>{const a=A[Math.floor(Math.random()*A.length)],e=String(Math.floor(Math.random()*999)).padStart(3,"0");return`${a}-${e}`},p=d(""),S=d([]),b=d(""),v=d([]),_=d([]),h=d(12),w=d(0),R=d(!0),T=d(null),D=d(null),Z=d(null),F=d(null),c=d(null),E=d(null),L=d(!0),O=d(!1),g=d(!1),f=ie({visible:!1,title:"",message:""}),I=(a,e)=>{f.title=a,f.message=e,f.visible=!0},G=a=>!a||Number.isNaN(a.getTime())?"":a.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}),M=de(()=>_.value.length?`${_.value.join(", ")} ë‹˜ì´ ì…ë ¥ ì¤‘...`:""),H=()=>{h.value<18&&(h.value+=1)},Q=()=>{h.value>8&&(h.value-=1)},j=()=>{R.value=!0,w.value=0,document.title=q},z=()=>{R.value=!1},P=()=>{c.value&&c.value.readyState===WebSocket.OPEN&&c.value.send(JSON.stringify({type:"endTyping",roomId:k,user:p.value}))},Y=()=>{E.value&&window.clearTimeout(E.value),c.value&&c.value.readyState===WebSocket.OPEN&&(c.value.send(JSON.stringify({type:"typing",roomId:k,user:p.value})),E.value=window.setTimeout(()=>{P()},1e3))},ee=a=>{const e=JSON.parse(a.data);if(e.type==="userList")return;if(e.type==="system"){S.value.push({text:e.text,sender:"System",timestamp:new Date,type:"system"});return}if(e.type==="typing"){Array.isArray(e.typingUsers)&&e.roomId===k&&(_.value=e.typingUsers);return}if(e.type==="endTyping"){const m=e.user;m&&(_.value=_.value.filter(N=>N!==m));return}let s;if(e.attachments)if(typeof e.attachments=="string")try{const m=JSON.parse(e.attachments);Array.isArray(m)&&(s=m)}catch{s=void 0}else Array.isArray(e.attachments)&&(s=e.attachments);const r=typeof e.sender=="string"&&e.sender||e.user&&typeof e.user.nickName=="string"&&e.user.nickName||"";let l=e.text||"";if(e.type==="connect"&&!l&&(!s||!s.length)&&(l="ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤."),!r&&!l&&(!s||!s.length))return;const i={text:l,sender:r||"System",timestamp:new Date(e.timestamp||Date.now()),type:e.type==="system"?"system":void 0,roomId:e.roomId,attachments:s};if(S.value.push(i),i.text&&i.sender!==p.value){const m=w.value+1;w.value=m,R.value||(document.title=`(${m}) ${q}`)}},W=()=>{let a=y.userNickName&&y.userNickName.trim()||p.value;a||(a=C()),p.value=a;const e=new WebSocket(ot);c.value=e,e.onopen=()=>{g.value=!0,e.readyState===WebSocket.OPEN&&e.send(JSON.stringify({type:"connect",roomId:k,user:{nickName:a}}))},e.onmessage=ee;const s=()=>{console.log("âŒ ì—°ê²° ì¢…ë£Œë¨, 3ì´ˆ í›„ ì¬ì—°ê²° ì‹œë„"),g.value=!1,setTimeout(()=>{L.value&&W()},3e3)};e.onclose=s,e.onerror=r=>{console.error("âš ï¸ ì†Œì¼“ ì˜¤ë¥˜ ë°œìƒ:",r),g.value=!1,e.close()}},B=a=>{const e=v.value[a];e?.preview&&URL.revokeObjectURL(e.preview),v.value.splice(a,1)},V=a=>{const e=a.target;if(!e.files)return;const s=50*1024*1024,l=Array.from(e.files).filter(i=>i.size>s?(I("ì•Œë¦¼",`${i.name}ì€(ëŠ”) 50MBë¥¼ ì´ˆê³¼í•˜ì—¬ ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),!1):!0);v.value.push(...l.map(i=>({file:i,type:i.type.startsWith("image/")?"image":"file",preview:i.type.startsWith("image/")?URL.createObjectURL(i):null,name:i.name}))),e.value=""},te=a=>{const e=a.clipboardData?.items;if(e){for(const s of e)if(s.type.indexOf("image")!==-1){a.preventDefault();const r=s.getAsFile();if(!r)return;const l=URL.createObjectURL(r);v.value.push({file:r,type:"image",preview:l,name:"ìº¡ì²˜ ì´ë¯¸ì§€.png"});break}}},J=async()=>{const a=b.value.trim();if(!(!a&&v.value.length===0)){if(!c.value||c.value.readyState!==WebSocket.OPEN||!g.value){I("ì˜¤ë¥˜","ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. (ì†Œì¼“ ì—°ê²° ì‹¤íŒ¨)");return}try{const e=[];for(const r of v.value){const l=new FormData;l.append("file",r.file);const m=(await he.post(nt,l,{headers:{"Content-Type":"multipart/form-data"}})).data,N=it+m.url;e.push({type:r.type,name:m.originalName||r.name,url:N,preview:N})}const s={type:"chat",text:a,sender:p.value||"ê²ŒìŠ¤íŠ¸",roomId:k,timestamp:new Date().toISOString(),attachments:e};c.value.send(JSON.stringify(s)),b.value="",v.value.forEach(r=>{r.preview&&URL.revokeObjectURL(r.preview)}),v.value=[]}catch(e){console.error(e),I("ì˜¤ë¥˜","íŒŒì¼ ì—…ë¡œë“œ ë˜ëŠ” ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},se=a=>{const e=T.value;if(!e){b.value+=a;return}const s=e.selectionStart??b.value.length,r=e.selectionEnd??b.value.length,l=b.value;b.value=l.slice(0,s)+a+l.slice(r),requestAnimationFrame(()=>{e.focus();const i=s+a.length;e.setSelectionRange(i,i)})},ae=()=>{b.value===""?P():Y()},re=a=>{if(a.key==="Enter"&&!a.shiftKey){if(O.value)return;a.preventDefault(),J()}},le=()=>{O.value=!0},oe=()=>{O.value=!1};return K(()=>S.value.length,()=>{setTimeout(()=>{F.value?.scrollIntoView({behavior:"smooth"})},100)}),K(()=>y.userNickName,a=>{p.value=a&&a.trim().length>0?a.trim():C(),c.value&&(c.value.close(),c.value=null),W()},{immediate:!0}),ce(()=>{L.value=!0,window.addEventListener("focus",j),window.addEventListener("blur",z),p.value||(p.value=y.userNickName&&y.userNickName.trim()||C())}),ue(()=>{L.value=!1,window.removeEventListener("focus",j),window.removeEventListener("blur",z),c.value&&c.value.close(),v.value.forEach(a=>{a.preview&&URL.revokeObjectURL(a.preview)})}),(a,e)=>(n(),o("div",ge,[t("header",ke,[t("div",ye,[t("div",{class:"flex items-center gap-2"},[e[6]||(e[6]=t("div",{class:"w-6 h-6 rounded-md bg-slate-200 dark:bg-slate-800 flex items-center justify-center text-xs text-slate-700 dark:text-slate-200"}," Î£ ",-1)),t("div",null,[e[5]||(e[5]=t("h1",{class:"text-sm font-semibold"}," ë°ì´í„° ë¶„ì„ ì‹œíŠ¸ - Sheet1.xlsx ",-1)),t("p",{class:"text-[10px] text-slate-500 dark:text-slate-400"}," Room #"+u(k))])]),t("div",_e,[t("div",we,[t("button",{onClick:Q,type:"button",class:"px-1 rounded hover:bg-slate-200 dark:hover:bg-slate-700"}," A- "),t("span",Se,u(h.value),1),t("button",{onClick:H,type:"button",class:"px-1 rounded hover:bg-slate-200 dark:hover:bg-slate-700"}," A+ ")]),t("div",Ne,[t("div",Ce,[t("span",{class:ve(["w-2 h-2 rounded-full",g.value?"bg-emerald-500":"bg-red-400"])},null,2),t("span",null,u(g.value?"ì—°ê²°ë¨":"ì—°ê²° ëŠê¹€"),1)]),t("div",Re,[e[7]||(e[7]=t("span",null,"ë‹‰ë„¤ì„",-1)),t("span",Ee,u(p.value),1)])])])]),e[8]||(e[8]=pe('<div class="bg-slate-100 dark:bg-slate-900 text-[11px] flex items-center px-2 py-1 border-t border-slate-200 dark:border-slate-800 text-slate-600 dark:text-slate-300"><span class="mr-3 font-semibold text-slate-900 dark:text-slate-50">í™ˆ</span><span class="mr-3">ì‚½ì…</span><span class="mr-3">í˜ì´ì§€ ë ˆì´ì•„ì›ƒ</span><span class="mr-3">ìˆ˜ì‹</span><span>ë°ì´í„°</span></div>',1))]),t("div",Le,[e[9]||(e[9]=t("div",{class:"bg-slate-50 dark:bg-slate-900 grid grid-cols-6 text-slate-700 dark:text-slate-200 text-xs border-b border-slate-200 dark:border-slate-800"},[t("div",{class:"px-2 py-1 font-medium border-r border-slate-200 dark:border-slate-800"},"ì‹œê°„"),t("div",{class:"px-2 py-1 font-medium border-r border-slate-200 dark:border-slate-800"},"ì‚¬ìš©ì"),t("div",{class:"px-2 py-1 font-medium col-span-4"},"ë°ì´í„°")],-1)),t("div",Oe,[(n(!0),o(U,null,$(S.value,(s,r)=>(n(),o("div",{key:`${s.sender}-${s.timestamp?.toString?.()||r}-${r}`,class:"grid grid-cols-6 border-b border-slate-100 dark:border-slate-800 text-xs",style:me({fontSize:h.value+"px"})},[t("div",Ie,u(G(s.timestamp)),1),t("div",Ue,[s.type==="system"?(n(),o("span",$e,"System")):(n(),o("span",Ae,u(s.sender),1)),s.sender===p.value&&s.type!=="system"?(n(),o("span",Te," (ë‚˜) ")):x("",!0)]),t("div",De,[s.text?(n(),o("div",Fe,u(s.text),1)):x("",!0),s.attachments&&s.attachments.length?(n(),o("div",Me,[(n(!0),o(U,null,$(s.attachments,(l,i)=>(n(),o("div",{key:i,class:"border border-slate-200 dark:border-slate-700 rounded-lg p-1 bg-slate-50 dark:bg-slate-900"},[l.type==="image"?(n(),o("img",{key:0,src:l.url||l.preview,alt:l.name,class:"w-20 h-20 object-cover rounded-md"},null,8,je)):(n(),o("a",{key:1,href:l.url,target:"_blank",rel:"noreferrer",class:"text-blue-500 underline text-[11px]"},u(l.name),9,ze))]))),128))])):x("",!0)])],4))),128)),t("div",{ref_key:"messagesEndRef",ref:F},null,512)])]),v.value.length?(n(),o("div",Pe,[t("div",We,[(n(!0),o(U,null,$(v.value,(s,r)=>(n(),o("div",{key:`${s.name}-${r}`,class:"relative group"},[s.type==="image"?(n(),o("div",Be,[t("img",{src:s.preview,alt:s.name,class:"w-16 h-16 object-cover rounded border border-slate-200 dark:border-slate-700"},null,8,Ve),t("button",{onClick:l=>B(r),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity text-[10px]"}," âœ• ",8,Je)])):(n(),o("div",Ke,[e[10]||(e[10]=t("span",{class:"text-xs"},"ğŸ“",-1)),t("span",qe,u(s.name),1),t("button",{onClick:l=>B(r),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity text-[10px]"}," âœ• ",8,Xe)]))]))),128))])])):x("",!0),M.value?(n(),o("div",Ze,u(M.value),1)):x("",!0),t("div",Ge,[t("div",He,[t("button",{class:"text-xl",type:"button",onClick:e[0]||(e[0]=s=>se("ğŸ˜Š"))}," ğŸ˜Š "),t("button",{class:"text-slate-400 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-200 transition-colors text-xl",type:"button",onClick:e[1]||(e[1]=s=>D.value?.click())}," ğŸ“ "),t("input",{ref_key:"fileInputRef",ref:D,type:"file",multiple:"",class:"hidden",onChange:V},null,544),t("input",{ref_key:"captureInputRef",ref:Z,type:"file",accept:"image/*",capture:"user",class:"hidden",onChange:V},null,544),be(t("textarea",{ref_key:"inputRef",ref:T,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),class:"flex-1 border rounded-lg px-2 py-1 text-sm leading-relaxed focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent transition-all resize-none max-h-24 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 border-slate-200 dark:border-slate-700",placeholder:"ë©”ì‹œì§€ ì…ë ¥... (Enter: ì „ì†¡, Shift+Enter: ì¤„ë°”ê¿ˆ, Ctrl+V: ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°)",rows:"1",onInput:ae,onKeydown:re,onCompositionstart:le,onCompositionend:oe,onPaste:te},null,544),[[fe,b.value]]),t("button",{class:"bg-slate-900 dark:bg-slate-100 hover:bg-black dark:hover:bg-white text-white dark:text-slate-900 rounded-lg px-3 py-1 text-sm transition-colors border border-slate-900 dark:border-slate-100",type:"button",onClick:J}," â¤ ")]),t("div",Qe,[t("span",Ye,[e[11]||(e[11]=xe(" ë‹‰ë„¤ì„: ",-1)),t("span",et,u(p.value),1)]),w.value>0?(n(),o("span",tt," ì•ˆ ì½ì€ ë©”ì‹œì§€ "+u(w.value)+"ê°œ ",1)):x("",!0),t("button",{type:"button",class:"ml-auto text-[10px] text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 flex items-center gap-1",onClick:e[3]||(e[3]=s=>a.$router.push("/chatList"))},[...e[12]||(e[12]=[t("span",null,"â¬…ï¸",-1),t("span",null,"ëª©ë¡ìœ¼ë¡œ",-1)])])])]),f.visible?(n(),o("div",st,[t("div",at,[t("h2",rt,u(f.title),1),t("p",lt,u(f.message),1),t("button",{class:"px-3 py-1.5 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded w-full",type:"button",onClick:e[4]||(e[4]=s=>f.visible=!1)}," í™•ì¸ ")])])):x("",!0)]))}});export{ut as default};
