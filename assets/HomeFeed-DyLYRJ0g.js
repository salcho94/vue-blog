import{d as I,r as d,o as T,w as U,c as A,a as $,b as l,e as a,f as z,v as G,g as E,t as n,F as f,h as y,n as H,i as h,j as N,k as P,u as S,R as V,l as K,m as O,p as _,q as o}from"./index-aNmRnDS9.js";const Z={class:"space-y-4"},J={class:"rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-3 md:p-4"},Q={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},W={class:"flex-1 max-w-xl"},X={class:"flex items-center gap-2 text-[12px] text-slate-500 dark:text-slate-400"},Y={key:0},ee={class:"mt-3 flex flex-wrap gap-1.5"},te=["onClick"],se={class:"opacity-60"},ae={key:0,class:"text-sm text-slate-500"},le={key:1,class:"text-sm text-red-400"},oe={key:2},re={key:0,class:"rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-6 text-center text-slate-500"},ne={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4"},de={class:"mt-1 text-[12px] text-slate-500 dark:text-slate-400 flex items-center gap-2"},ie={class:"ml-auto"},ue={class:"mt-3 text-[14px] leading-relaxed text-slate-700 dark:text-slate-200 line-clamp-3"},ce={class:"mt-3 flex flex-wrap gap-1"},ve={class:"mt-4 flex items-center justify-between"},xe={class:"mt-4 flex items-center justify-center"},me=["disabled"],be={key:1,class:"text-[12px] text-slate-500"},w=4,fe=I({__name:"HomeFeed",setup(ge){const j=K(),i=d([]),C=d([]),v=d(!0),u=d(""),k=d(""),r=d(null),p=d(null),x=d(!1),m=d(!1);T(async()=>{v.value=!0,u.value="";try{const e=j.query.tag||null;r.value=e;const[s,t]=await Promise.all([O(),_({limit:w,tag:r.value})]);C.value=s,i.value=t.items,p.value=t.nextCursor,m.value=t.isEnd}catch(e){u.value=e?.message||"피드를 불러올 수 없습니다."}finally{v.value=!1}});const q=async e=>{r.value=r.value===e?null:e};U(r,async()=>{v.value=!0,u.value="";try{const e=await _({limit:w,tag:r.value});i.value=e.items,p.value=e.nextCursor,m.value=e.isEnd}catch(e){u.value=e?.message||"피드를 불러올 수 없습니다."}finally{v.value=!1}});const M=async()=>{if(!(x.value||m.value)){x.value=!0;try{const e=await _({limit:w,cursor:p.value,tag:r.value});i.value=i.value.concat(e.items),p.value=e.nextCursor,m.value=e.isEnd}catch{}finally{x.value=!1}}},B=A(()=>{const e=k.value.trim().toLowerCase();return e?i.value.filter(s=>{const t=(s.title||"").toLowerCase(),c=(s.summary||"").toLowerCase(),R=(s.content||"").toLowerCase(),F=(s.authorName||"").toLowerCase();return t.includes(e)||c.includes(e)||R.includes(e)||F.includes(e)}):i.value}),L=A(()=>[...B.value].sort((e,s)=>{const t=e.createdAt?.toMillis?.()??e.updatedAt?.toMillis?.()??0;return(s.createdAt?.toMillis?.()??s.updatedAt?.toMillis?.()??0)-t})),D=e=>{try{const s=e?.toDate?.();if(s)return s.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{}return""},b=d(null);let g=null;return T(()=>{g=new IntersectionObserver(e=>{e[0]?.isIntersecting&&M()},{rootMargin:"120px"}),b.value&&g.observe(b.value)}),$(()=>{g&&b.value&&g.unobserve(b.value),g?.disconnect()}),(e,s)=>(o(),l("div",Z,[a("section",J,[a("div",Q,[a("div",W,[z(a("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),type:"search",placeholder:"검색: 제목, 요약, 본문, 작성자",class:"w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 md:py-2.5 text-[14px] outline-none focus:ring-2 focus:ring-black dark:focus:ring-yellow-400"},null,512),[[G,k.value]])]),a("div",X,[r.value?(o(),l("span",Y,"#"+n(r.value),1)):E("",!0),r.value?(o(),l("button",{key:1,class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-700 hover:border-black dark:hover:border-yellow-400",onClick:s[1]||(s[1]=t=>r.value=null)}," 태그 해제 ")):E("",!0)])]),a("div",ee,[(o(!0),l(f,null,y(C.value,t=>(o(),l("button",{key:t.name,onClick:c=>q(t.name),class:H(["px-2 py-1 rounded-md text-[12px] border transition hover:border-black dark:hover:border-yellow-400",[r.value===t.name?"bg-black text-white dark:bg-yellow-400 dark:text-black border-transparent":"bg-slate-100 dark:bg-slate-900/70 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-slate-800"]])},[h(" #"+n(t.name)+" ",1),a("span",se,"("+n(t.count)+")",1)],10,te))),128))])]),v.value?(o(),l("div",ae,"피드 로딩 중...")):u.value?(o(),l("div",le,n(u.value),1)):(o(),l("section",oe,[L.value.length===0?(o(),l("div",re," 게시글이 없습니다. ")):(o(),l("ul",ne,[(o(!0),l(f,null,y(L.value,t=>(o(),l("li",{key:t.id,class:"group rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-4 hover:shadow-lg transition-shadow"},[N(S(V),{to:{name:"post-detail",params:{id:String(t.id)}},class:"block text-[18px] md:text-[19px] font-semibold text-slate-900 dark:text-slate-100 group-hover:underline underline-offset-4"},{default:P(()=>[h(n(t.title||"untitled.md"),1)]),_:2},1032,["to"]),a("div",de,[a("span",null,n(t.authorName||"익명"),1),s[2]||(s[2]=a("span",null,"·",-1)),a("span",null,n(D(t.createdAt)),1),a("span",ie,n(t.views??0)+" views · "+n(t.likes??0)+" likes",1)]),a("p",ue,n(t.summary||t.content),1),a("div",ce,[(o(!0),l(f,null,y(t.tags||[],c=>(o(),l("span",{key:c,class:"px-2 py-0.5 rounded-md text-[11px] bg-slate-100 dark:bg-slate-900/70 text-slate-700 dark:text-slate-200"}," #"+n(c),1))),128))]),a("div",ve,[N(S(V),{to:{name:"post-detail",params:{id:String(t.id)}},class:"px-3 py-1.5 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300 transition"},{default:P(()=>[...s[3]||(s[3]=[h(" 자세히 보기 ",-1)])]),_:1},8,["to"])])]))),128))])),a("div",xe,[m.value?(o(),l("span",be,"마지막 페이지")):(o(),l("button",{key:0,onClick:M,disabled:x.value,class:"px-4 py-2 rounded-md text-[13px] font-semibold border border-slate-300 dark:border-slate-700 hover:border-black dark:hover:border-yellow-400 disabled:opacity-60"},n(x.value?"불러오는 중...":"더보기"),9,me))]),a("div",{ref_key:"sentinel",ref:b,class:"h-6"},null,512)]))]))}});export{fe as default};
