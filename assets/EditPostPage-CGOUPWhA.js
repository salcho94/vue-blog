import{d as j,I as E,H as D,l as q,r as d,c as A,o as W,O as Y,b as r,e as a,g as V,t as i,f as m,v as k,W as Z,F as g,h as O,i as b,Y as F,Z as J,u as z,L as G,_ as Q,q as o}from"./index-J_ORtUVl.js";import{u as X}from"./upload-sG1ZtkYU.js";import{M as ee}from"./index-BMSQkwth.js";const te={class:"max-w-3xl mx-auto space-y-4"},se={key:0,class:"text-xs text-slate-500"},ae={key:1,class:"text-xs text-red-400"},le={key:2,class:"grid gap-3 text-[12px]"},re={class:"grid gap-1"},oe={class:"grid gap-1"},ne={class:"grid gap-1"},de={class:"flex items-center gap-2 text-[11px]"},ie=["disabled"],ue={class:"mt-2 border border-slate-200 dark:border-slate-700 rounded-md p-3 bg-white dark:bg-slate-900"},pe={class:"flex items-center justify-between mb-2"},ve={class:"flex items-center gap-2"},me=["innerHTML"],ge={class:"grid gap-2"},be={class:"flex flex-wrap gap-1.5"},fe=["onClick"],ce=["onKeydown","onKeyup"],xe={key:0,class:"rounded-md border border-slate-200 dark:border-slate-800 p-3 bg-slate-50 dark:bg-slate-900/50"},ye={class:"list-disc pl-5 space-y-0.5 text-[11px]"},ke={class:"flex items-center gap-2 pt-1"},he=["disabled"],Pe=j({__name:"EditPostPage",setup(we){const B=q(),C=G(),I=E(),v=D(),h=B.params.id,n=d(null),t=d(null),P=d(!0),f=d(!1),u=d(""),S=d(null),c=d(!1),K=new ee({breaks:!0}),T=d(""),x=d(!0),w=()=>{T.value=K.render(t.value?.content||"")},U=l=>{if(!t.value)return;const e=`

![image](${l})
`;t.value.content=(t.value.content||"")+e,w()},H=()=>{S.value?.click()},L=async l=>{const e=l.target,s=e.files?.[0];if(s)try{c.value=!0,u.value="";const p=await X(s);U(p)}catch(p){const N=p?.message||"이미지 업로드 실패";u.value=N,v.alert({title:"이미지 업로드 오류",message:N,type:"error"})}finally{c.value=!1,e.value=""}},y=d("");function _(){const l=y.value.trim();!l||!t.value||(l.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{t.value.tags||(t.value.tags=[]),t.value.tags.includes(e)||t.value.tags.push(e)}),y.value="")}function R(l){t.value?.tags&&(t.value.tags=t.value.tags.filter(e=>e!==l))}const M=A(()=>{if(!n.value||!t.value)return[];const l=[],e=(s,p)=>JSON.stringify(s)!==JSON.stringify(p);return e(n.value.title||"",t.value.title||"")&&l.push({field:"제목",before:n.value.title||"",after:t.value.title||""}),e(n.value.summary||"",t.value.summary||"")&&l.push({field:"요약",before:n.value.summary||"",after:t.value.summary||""}),e(n.value.content||"",t.value.content||"")&&l.push({field:"본문",before:"…",after:"…"}),e(n.value.tags||[],t.value.tags||[])&&l.push({field:"태그",before:n.value.tags||[],after:t.value.tags||[]}),e(!!n.value.isPublished,!!t.value.isPublished)&&l.push({field:"공개 여부",before:!!n.value.isPublished,after:!!t.value.isPublished}),l});W(async()=>{try{const l=await Y(h);if(!l){const e="포스트를 찾을 수 없습니다.";u.value=e,v.alert({title:"불러오기 오류",message:e,type:"error"});return}if(!I.user||I.user.uid!==l.authorId){const e="수정 권한이 없습니다.";u.value=e,v.alert({title:"권한 오류",message:e,type:"error"});return}n.value=JSON.parse(JSON.stringify(l)),t.value=JSON.parse(JSON.stringify(l)),t.value.tags||(t.value.tags=[]),w()}catch(l){const e=l?.message||"불러오기 실패";u.value=e,v.alert({title:"불러오기 오류",message:e,type:"error"})}finally{P.value=!1}});async function $(){if(!t.value)return;const l=t.value.title?.trim()||"",e=t.value.content?.trim()||"";if(!l||!e){v.alert({title:"작성 오류",message:"제목과 내용을 모두 입력하세요.",type:"error"});return}f.value=!0,u.value="";try{await Q(h,{title:l,summary:t.value.summary?.trim()||"",content:t.value.content,tags:(t.value.tags||[]).map(s=>s.trim()).filter(Boolean),isPublished:!!t.value.isPublished}),v.alert({title:"저장 완료",message:"글이 성공적으로 수정되었습니다.",type:"success"}),C.push({name:"post-detail",params:{id:h}})}catch(s){const p=s?.message||"수정 실패";u.value=p,v.alert({title:"수정 실패",message:p,type:"error"})}finally{f.value=!1}}return(l,e)=>(o(),r("div",te,[e[15]||(e[15]=a("h1",{class:"text-xl font-semibold text-slate-900 dark:text-slate-100"}," 글 수정 ",-1)),P.value?(o(),r("div",se,"loading...")):u.value?(o(),r("div",ae,i(u.value),1)):t.value?(o(),r("div",le,[a("label",re,[e[7]||(e[7]=a("span",{class:"text-slate-500"},"제목",-1)),m(a("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.title=s),placeholder:"제목을 입력하세요",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[k,t.value.title]])]),a("label",oe,[e[8]||(e[8]=a("span",{class:"text-slate-500"},"요약",-1)),m(a("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.summary=s),placeholder:"요약(메타/리스트 미리보기)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[k,t.value.summary]])]),a("label",ne,[e[11]||(e[11]=a("span",{class:"text-slate-500"},"본문",-1)),a("div",de,[a("button",{type:"button",onClick:H,disabled:c.value,class:"px-3 py-1.5 rounded-md border border-slate-300 text-slate-700 dark:text-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800 disabled:opacity-60"},i(c.value?"이미지 업로드 중…":"이미지 추가"),9,ie),e[9]||(e[9]=a("span",{class:"text-[10px] text-slate-400"}," 업로드하면 본문에 이미지 마크다운이 자동으로 추가됩니다. ",-1)),a("input",{ref_key:"fileInputRef",ref:S,type:"file",accept:"image/*",class:"hidden",onChange:L},null,544)]),m(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.content=s),rows:"12",placeholder:"내용을 입력하세요 (마크다운 지원, 예: # 제목)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-3 font-mono text-[12px]"},null,512),[[k,t.value.content]]),a("div",ue,[a("div",pe,[e[10]||(e[10]=a("div",{class:"text-[10px] text-slate-400"}," 미리보기 ",-1)),a("div",ve,[a("button",{type:"button",onClick:w,class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"}," 새로고침 "),a("button",{type:"button",onClick:e[3]||(e[3]=s=>x.value=!x.value),class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"},i(x.value?"접기":"열기"),1)])]),m(a("div",{class:"prose prose-sm max-w-none dark:prose-invert",innerHTML:T.value},null,8,me),[[Z,x.value]])])]),a("div",ge,[e[12]||(e[12]=a("span",{class:"text-slate-500"},"태그",-1)),a("div",be,[(o(!0),r(g,null,O(t.value.tags,s=>(o(),r("span",{key:s,class:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-200 text-[11px]"},[b(" #"+i(s)+" ",1),a("button",{class:"ml-1 text-slate-500 hover:text-red-500",onClick:p=>R(s),title:"remove"}," ✕ ",8,fe)]))),128))]),m(a("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),onKeydown:F(J(_,["prevent"]),["enter"]),onKeyup:F(J(_,["prevent"]),["enter"]),placeholder:"엔터/콤마로 추가 (예: Vue, Firebase)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]",onInput:e[5]||(e[5]=s=>{s.data===","&&_()})},null,40,ce),[[k,y.value]]),e[13]||(e[13]=a("p",{class:"text-[11px] text-slate-400"},[b(" 예시: "),a("code",null,"Vue, Firebase, Tailwind")],-1))]),M.value.length?(o(),r("div",xe,[e[14]||(e[14]=a("div",{class:"text-[12px] font-medium mb-1"},"변경사항",-1)),a("ul",ye,[(o(!0),r(g,null,O(M.value,s=>(o(),r("li",{key:s.field},[a("strong",null,i(s.field),1),s.field!=="본문"&&s.field!=="태그"?(o(),r(g,{key:0},[b(" : “"+i(s.before)+"” → “"+i(s.after)+"” ",1)],64)):s.field==="태그"?(o(),r(g,{key:1},[b(" : "+i(s.before.join(", ")||"없음")+" → "+i(s.after.join(", ")||"없음"),1)],64)):(o(),r(g,{key:2},[b(" (내용 변경) ")],64))]))),128))])])):V("",!0),a("div",ke,[a("button",{onClick:$,disabled:f.value,class:"px-4 py-2 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 disabled:opacity-60 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300"},i(f.value?"저장 중…":"저장"),9,he),a("button",{type:"button",class:"px-3 py-2 rounded-md text-[12px] border border-slate-300 dark:border-slate-700",onClick:e[6]||(e[6]=s=>z(C).back())}," 취소 ")])])):V("",!0)]))}});export{Pe as default};
