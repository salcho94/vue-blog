import{d as S,I as B,H,r as s,b as w,e as t,g as N,f as u,v as m,t as x,W as U,X as L,L as R,q as _}from"./index-Dlo8-019.js";import{u as $}from"./upload-C2eUbfjM.js";import{M as D}from"./index-BMSQkwth.js";const j={class:"max-w-2xl mx-auto space-y-3"},q={class:"space-y-2 text-[11px]"},A={class:"flex items-center gap-2"},E={class:"mt-1 border border-slate-200 dark:border-slate-700 rounded-md p-3 bg-white dark:bg-slate-900"},F={class:"flex items-center justify-between mb-2"},O={class:"flex items-center gap-2"},W=["innerHTML"],X=["disabled"],z={key:0,class:"text-[10px] text-red-400"},Y=S({__name:"NewPostPage",setup(G){const c=B(),C=R(),i=H(),b=s(""),v=s(""),n=s(""),g=s(""),o=s(!1),d=s(""),f=s(null),I=new D({breaks:!0}),k=s(""),p=s(!0),y=()=>{k.value=I.render(n.value)},M=r=>{const e=`

![image](${r})
`;n.value+=e,y()},T=()=>{f.value?.click()},V=async r=>{const e=r.target,a=e.files?.[0];if(a)try{o.value=!0,d.value="";const l=await $(a);M(l)}catch(l){const h=l?.message||"이미지 업로드 실패";d.value=h,i.alert({title:"이미지 업로드 오류",message:h,type:"error"})}finally{o.value=!1,e.value=""}},P=async()=>{if(!c.user){i.alert({title:"로그인 필요",message:"로그인 후 글을 작성할 수 있습니다.",type:"info"});return}const r=b.value.trim(),e=n.value.trim();if(!r||!e){i.alert({title:"작성 오류",message:"제목과 내용을 모두 입력하세요.",type:"error"});return}o.value=!0,d.value="";try{const a=await L({title:r,summary:v.value.trim(),content:e,tags:g.value.split(",").map(l=>l.trim()).filter(Boolean),authorId:c.user.uid,authorName:c.user.email||"user",isPublished:!0});await C.push(`/posts/${a}`)}catch(a){const l=a?.message||"등록 실패";d.value=l,i.alert({title:"등록 실패",message:l,type:"error"})}finally{o.value=!1}};return(r,e)=>(_(),w("div",j,[e[7]||(e[7]=t("h1",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100"}," 글 작성 ",-1)),t("div",q,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),placeholder:"제목",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[m,b.value]]),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),placeholder:"요약 (선택)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[m,v.value]]),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),placeholder:"태그 (쉼표로 구분)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[m,g.value]]),t("div",A,[t("button",{type:"button",onClick:T,class:"px-3 py-1.5 rounded-md border border-slate-300 text-[11px] text-slate-700 dark:text-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800"}," 이미지 추가 "),e[5]||(e[5]=t("span",{class:"text-[10px] text-slate-400"}," 업로드하면 본문에 이미지 마크다운이 자동으로 추가됩니다. ",-1)),t("input",{ref_key:"fileInputRef",ref:f,type:"file",accept:"image/*",class:"hidden",onChange:V},null,544)]),u(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),rows:"10",placeholder:"내용 (마크다운 지원, 예: # 제목)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-2 font-mono"},null,512),[[m,n.value]])]),t("div",E,[t("div",F,[e[6]||(e[6]=t("div",{class:"text-[10px] text-slate-400"}," 미리보기 ",-1)),t("div",O,[t("button",{type:"button",onClick:y,class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"}," 새로고침 "),t("button",{type:"button",onClick:e[4]||(e[4]=a=>p.value=!p.value),class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"},x(p.value?"접기":"열기"),1)])]),u(t("div",{class:"prose prose-sm max-w-none dark:prose-invert",innerHTML:k.value},null,8,W),[[U,p.value]])]),t("button",{onClick:P,disabled:o.value,class:"px-4 py-2 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 disabled:opacity-60 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300"},x(o.value?"처리 중...":"게시"),9,X),d.value?(_(),w("p",z,x(d.value),1)):N("",!0)]))}});export{Y as default};
