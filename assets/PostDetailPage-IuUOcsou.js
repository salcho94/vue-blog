import{s as T,x as j,y as z,z as E,A as F,B as O,C as U,D as $,E as N,G,d as H,H as J,r as v,c as C,l as K,w as I,o as Q,b as r,g as p,t as u,e as s,I as W,k as X,i as D,u as g,R as Y,F as P,h as B,f as Z,v as ee,J as te,K as ae,L as se,q as l,M as L,N as le,O as oe}from"./index-CqFP1vA1.js";const A=F(N,"comments");async function re(x){await T(A,{...x,createdAt:G()})}async function b(x){const h=j(A,E("postId","==",x),z("createdAt","asc"));return(await O(h)).docs.map(a=>({id:a.id,...a.data()}))}async function ne(x){await U($(N,"comments",x))}const ue={class:"max-w-3xl mx-auto space-y-4"},ie={key:0,class:"text-xs text-slate-500"},de={key:1,class:"text-xs text-red-400"},ce={key:2,class:"space-y-5"},ve={class:"flex items-center justify-between gap-3"},xe={class:"text-2xl font-semibold text-slate-900 dark:text-slate-100"},me={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},pe=["disabled","title"],fe={class:"text-xs"},ke={class:"whitespace-pre-wrap text-[14px] leading-relaxed text-slate-800 dark:text-slate-100 bg-slate-50 dark:bg-slate-900/90 rounded-2xl p-4"},ge={key:0,class:"flex flex-wrap gap-2 mt-3"},he={class:"space-y-3"},ye={class:"text-sm font-medium text-slate-800 dark:text-slate-100 flex items-center gap-2"},be={class:"text-[10px] text-slate-500"},_e={key:0,class:"flex gap-2 items-start"},we={key:1,class:"text-[11px] text-slate-500"},Ce={key:2,class:"space-y-1.5"},Ie={class:"space-y-0.5"},De={class:"font-medium text-slate-700 dark:text-slate-300"},Pe={class:"text-slate-700 dark:text-slate-100"},Be=["onClick"],Le={key:3,class:"text-[11px] text-slate-500"},Ve=H({__name:"PostDetailPage",setup(x){const h=K(),_=ae(),a=J(),t=v(null),i=v([]),y=v(!0),m=v(""),f=v(""),d=v(!1),k=v(!1),c=C(()=>h.params.id);async function V(e){if(!e){m.value="잘못된 포스트 ID입니다.",t.value=null,i.value=[],d.value=!1;return}y.value=!0,m.value="";try{const o=await le(e);if(!o){m.value="포스트를 찾을 수 없습니다.",t.value=null,i.value=[],d.value=!1;return}t.value=o,oe(e).catch(()=>{}),i.value=await b(e),a.user?d.value=await L(e,a.user.uid):d.value=!1}catch(o){m.value=o?.message||"불러오기 실패",t.value=null,i.value=[],d.value=!1}finally{y.value=!1}}I(c,e=>{e&&V(e)},{immediate:!0}),I(()=>a.user?.uid,async e=>{t.value&&(d.value=e?await L(c.value,e):!1)}),Q(()=>{a.init?.()});const w=C(()=>!!(a.user&&t.value&&a.user.uid===t.value.authorId));async function M(){if(!a.user){alert("로그인이 필요합니다.");return}const e=f.value.trim();if(!(!e||!c.value))try{await re({postId:c.value,authorId:a.user.uid,authorName:a.user.email||"user",content:e}),f.value="",i.value=await b(c.value)}catch(o){alert(o?.message||"댓글 등록 실패")}}async function R(e,o){if(!(!a.user||a.user.uid!==o))try{await ne(e),c.value&&(i.value=await b(c.value))}catch(n){alert(n?.message||"댓글 삭제 실패")}}async function q(){if(t.value&&confirm("이 글을 삭제할까요?"))try{await te(t.value.id),_.push("/posts")}catch(e){alert(e?.message||"삭제 실패")}}async function S(){if(t.value){if(!a.user){alert("로그인이 필요합니다.");return}if(!k.value){k.value=!0;try{const e=await se(t.value.id,a.user.uid);d.value=e.liked,t.value&&(t.value.likes=e.likes)}catch(e){console.error(e),alert(e?.message||"좋아요 처리 중 오류가 발생했습니다.")}finally{k.value=!1}}}}return(e,o)=>(l(),r("div",ue,[y.value?(l(),r("div",ie,"loading...")):m.value?(l(),r("div",de,u(m.value),1)):t.value?(l(),r("div",ce,[s("div",ve,[s("h1",xe,u(t.value.title),1),s("div",me,[s("span",null,u(t.value.views??0)+" views",1),s("button",{onClick:S,disabled:k.value,class:"inline-flex items-center gap-1 px-2 py-1 rounded-md border border-slate-300/80 dark:border-slate-600/80 bg-white/90 dark:bg-slate-900/80 hover:border-cyan-400 hover:text-cyan-300 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",title:d.value?"좋아요 취소":"좋아요"},[s("span",fe,u(d.value?"★":"☆"),1),s("span",null,u(t.value.likes??0),1)],8,pe),w.value?(l(),W(g(Y),{key:0,to:`/admin/edit/${t.value.id}`,class:"px-2 py-1 rounded-md bg-slate-900 text-slate-100 hover:bg-black dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300 transition-colors"},{default:X(()=>[...o[1]||(o[1]=[D(" 수정 ",-1)])]),_:1},8,["to"])):p("",!0),w.value?(l(),r("button",{key:1,onClick:q,class:"px-2 py-1 rounded-md bg-red-500 text-white hover:bg-red-400 transition-colors"}," 삭제 ")):p("",!0)])]),s("article",ke,u(t.value.content),1),t.value.tags&&t.value.tags.length?(l(),r("div",ge,[(l(!0),r(P,null,B(t.value.tags,n=>(l(),r("span",{key:n,class:"px-2 py-1 rounded-md text-[11px] bg-slate-100 dark:bg-slate-900/70 text-slate-700 dark:text-slate-200 border border-transparent hover:border-black dark:hover:border-yellow-400 cursor-default select-none transition"}," #"+u(n),1))),128))])):p("",!0),s("section",he,[s("h2",ye,[o[2]||(o[2]=D(" comments ",-1)),s("span",be,"("+u(i.value.length)+")",1)]),g(a).user?(l(),r("div",_e,[Z(s("textarea",{"onUpdate:modelValue":o[0]||(o[0]=n=>f.value=n),rows:"2",class:"flex-1 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1.5 text-[12px] text-slate-800 dark:text-slate-100 resize-none focus:outline-none focus:ring-1 focus:ring-black dark:focus:ring-yellow-400",placeholder:"댓글을 입력하세요"},null,512),[[ee,f.value]]),s("button",{onClick:M,class:"px-3 py-1.5 rounded-md text-[11px] font-semibold bg-black text-white hover:bg-slate-800 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300 transition-colors"}," 등록 ")])):(l(),r("div",we," 댓글을 작성하려면 로그인하세요. ")),i.value.length?(l(),r("div",Ce,[(l(!0),r(P,null,B(i.value,n=>(l(),r("div",{key:n.id,class:"flex items-start justify-between gap-2 rounded-md bg-slate-100 dark:bg-slate-900/80 px-2 py-1.5 text-[11px]"},[s("div",Ie,[s("div",De,u(n.authorName||"user"),1),s("div",Pe,u(n.content),1)]),g(a).user&&g(a).user.uid===n.authorId?(l(),r("button",{key:0,onClick:Ne=>R(n.id,n.authorId),class:"mt-1 text-[10px] text-red-400 hover:text-red-300"}," 삭제 ",8,Be)):p("",!0)]))),128))])):(l(),r("div",Le," 아직 댓글이 없습니다. "))])])):p("",!0)]))}});export{Ve as default};
