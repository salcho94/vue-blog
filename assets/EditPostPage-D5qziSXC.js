import{d as F,H as T,l as I,r as d,c as P,o as M,N as U,b as r,e as l,g as S,t as n,f as m,v as b,F as v,h as V,i as p,W as C,X as J,u as E,K as j,Y as D,q as o}from"./index-CqFP1vA1.js";const R={class:"max-w-3xl mx-auto space-y-4"},$={key:0,class:"text-xs text-slate-500"},q={key:1,class:"text-xs text-red-400"},A={key:2,class:"grid gap-3 text-[12px]"},H={class:"grid gap-1"},L={class:"grid gap-1"},W={class:"grid gap-1"},X={class:"grid gap-2"},Y={class:"flex flex-wrap gap-1.5"},z=["onClick"],G=["onKeydown","onKeyup"],Q={key:0,class:"rounded-md border border-slate-200 dark:border-slate-800 p-3 bg-slate-50 dark:bg-slate-900/50"},Z={class:"list-disc pl-5 space-y-0.5 text-[11px]"},ee={class:"flex items-center gap-2 pt-1"},te=["disabled"],le=F({__name:"EditPostPage",setup(ae){const K=I(),y=j(),k=T(),x=K.params.id,u=d(null),e=d(null),h=d(!0),f=d(!1),i=d(""),g=d("");function c(){const s=g.value.trim();!s||!e.value||(s.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>{e.value.tags||(e.value.tags=[]),e.value.tags.includes(t)||e.value.tags.push(t)}),g.value="")}function O(s){e.value?.tags&&(e.value.tags=e.value.tags.filter(t=>t!==s))}const w=P(()=>{if(!u.value||!e.value)return[];const s=[],t=(a,N)=>JSON.stringify(a)!==JSON.stringify(N);return t(u.value.title||"",e.value.title||"")&&s.push({field:"제목",before:u.value.title||"",after:e.value.title||""}),t(u.value.summary||"",e.value.summary||"")&&s.push({field:"요약",before:u.value.summary||"",after:e.value.summary||""}),t(u.value.content||"",e.value.content||"")&&s.push({field:"본문",before:"…",after:"…"}),t(u.value.tags||[],e.value.tags||[])&&s.push({field:"태그",before:u.value.tags||[],after:e.value.tags||[]}),t(!!u.value.isPublished,!!e.value.isPublished)&&s.push({field:"공개 여부",before:!!u.value.isPublished,after:!!e.value.isPublished}),s}),_=P(()=>!!e.value&&!!(e.value.title&&e.value.title.trim())&&!!(e.value.content&&e.value.content.trim()));M(async()=>{try{const s=await U(x);if(!s){i.value="포스트를 찾을 수 없습니다.";return}if(!k.user||k.user.uid!==s.authorId){i.value="수정 권한이 없습니다.";return}u.value=JSON.parse(JSON.stringify(s)),e.value=JSON.parse(JSON.stringify(s)),e.value.tags||(e.value.tags=[])}catch(s){i.value=s.message||"불러오기 실패"}finally{h.value=!1}});async function B(){if(!(!e.value||!_.value)){f.value=!0,i.value="";try{await D(x,{title:e.value.title?.trim(),summary:e.value.summary?.trim()||"",content:e.value.content,tags:(e.value.tags||[]).map(s=>s.trim()).filter(Boolean),isPublished:!!e.value.isPublished}),y.push({name:"post-detail",params:{id:x}})}catch(s){i.value=s.message||"수정 실패"}finally{f.value=!1}}}return(s,t)=>(o(),r("div",R,[t[12]||(t[12]=l("h1",{class:"text-xl font-semibold text-slate-900 dark:text-slate-100"}," 글 수정 ",-1)),h.value?(o(),r("div",$,"loading...")):i.value?(o(),r("div",q,n(i.value),1)):e.value?(o(),r("div",A,[l("label",H,[t[6]||(t[6]=l("span",{class:"text-slate-500"},"제목",-1)),m(l("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a),placeholder:"제목을 입력하세요",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[b,e.value.title]])]),l("label",L,[t[7]||(t[7]=l("span",{class:"text-slate-500"},"요약",-1)),m(l("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.summary=a),placeholder:"요약(메타/리스트 미리보기)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]"},null,512),[[b,e.value.summary]])]),l("label",W,[t[8]||(t[8]=l("span",{class:"text-slate-500"},"본문",-1)),m(l("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.content=a),rows:"12",placeholder:"내용을 입력하세요",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-3 font-mono text-[12px]"},null,512),[[b,e.value.content]])]),l("div",X,[t[9]||(t[9]=l("span",{class:"text-slate-500"},"태그",-1)),l("div",Y,[(o(!0),r(v,null,V(e.value.tags,a=>(o(),r("span",{key:a,class:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-200 text-[11px]"},[p(" #"+n(a)+" ",1),l("button",{class:"ml-1 text-slate-500 hover:text-red-500",onClick:N=>O(a),title:"remove"},"✕",8,z)]))),128))]),m(l("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>g.value=a),onKeydown:C(J(c,["prevent"]),["enter"]),onKeyup:C(J(c,["prevent"]),["enter"]),placeholder:"엔터/콤마로 추가 (예: Vue, Firebase)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 text-[13px]",onInput:t[4]||(t[4]=a=>{a.data===","&&c()})},null,40,G),[[b,g.value]]),t[10]||(t[10]=l("p",{class:"text-[11px] text-slate-400"},[p("예시: "),l("code",null,"Vue, Firebase, Tailwind")],-1))]),w.value.length?(o(),r("div",Q,[t[11]||(t[11]=l("div",{class:"text-[12px] font-medium mb-1"},"변경사항",-1)),l("ul",Z,[(o(!0),r(v,null,V(w.value,a=>(o(),r("li",{key:a.field},[l("strong",null,n(a.field),1),a.field!=="본문"&&a.field!=="태그"?(o(),r(v,{key:0},[p(" : “"+n(a.before)+"” → “"+n(a.after)+"” ",1)],64)):a.field==="태그"?(o(),r(v,{key:1},[p(" : "+n(a.before.join(", ")||"없음")+" → "+n(a.after.join(", ")||"없음"),1)],64)):(o(),r(v,{key:2},[p(" (내용 변경) ")],64))]))),128))])])):S("",!0),l("div",ee,[l("button",{onClick:B,disabled:f.value||!_.value,class:"px-4 py-2 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 disabled:opacity-60 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300"},n(f.value?"저장 중…":"저장"),9,te),l("button",{type:"button",class:"px-3 py-2 rounded-md text-[12px] border border-slate-300 dark:border-slate-700",onClick:t[5]||(t[5]=a=>E(y).back())}," 취소 ")])])):S("",!0)]))}});export{le as default};
