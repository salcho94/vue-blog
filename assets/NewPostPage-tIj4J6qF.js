import{d as B,I as F,H as L,r as l,b as h,e as a,g as N,f as u,W as J,F as $,h as O,t as v,v as b,X as W,Y as j,L as q,q as w,Z as G}from"./index-BKuYG3Mt.js";import{u as X}from"./upload-UyIAgWlm.js";import{M as Y}from"./index-BMSQkwth.js";const Z={class:"max-w-2xl mx-auto space-y-3"},z={class:"flex items-center gap-2"},K=["value"],Q={class:"space-y-2 text-[11px]"},ee={class:"flex items-center gap-2"},te={class:"mt-1 border border-slate-200 dark:border-slate-700 rounded-md p-3 bg-white dark:bg-slate-900"},ae={class:"flex items-center justify-between mb-2"},se={class:"flex items-center gap-2"},re=["innerHTML"],le=["disabled"],oe={key:0,class:"text-[10px] text-red-400"},ce=B({__name:"NewPostPage",setup(ne){const g=F(),M=q(),c=L(),V=["Java","TypeScript/JavaScript","React","Vue","GitHub","Other","여행"],p=l("Java"),x=l(""),f=l(""),o=l(""),y=l(""),n=l(!1),d=l(""),I=l(null),_=l(null),P=new Y({breaks:!0}),C=l(""),m=l(!0),S=()=>{C.value=P.render(o.value)},R=r=>{const e=o.value||"",t=`

![image](${r})
`,s=_.value;if(s){const i=s.selectionStart??e.length,k=s.selectionEnd??i;o.value=e.slice(0,i)+t+e.slice(k),G(()=>{const A=i+t.length;s.selectionStart=s.selectionEnd=A})}else o.value=e+t;S()},T=async r=>{try{n.value=!0,d.value="";const e=await X(r);R(e)}catch(e){const t=e?.message||"이미지 업로드 실패";d.value=t,c.alert({title:"이미지 업로드 오류",message:t,type:"error"})}finally{n.value=!1}},D=()=>{I.value?.click()},E=async r=>{const e=r.target,t=e.files?.[0];t&&(await T(t),e.value="")},H=async r=>{const e=r.clipboardData;if(!e)return;const s=Array.from(e.items).find(k=>k.type.startsWith("image/"));if(!s)return;const i=s.getAsFile();i&&(r.preventDefault(),await T(i))},U=async()=>{if(!g.user){c.alert({title:"로그인 필요",message:"로그인 후 글을 작성할 수 있습니다.",type:"info"});return}const r=x.value.trim(),e=o.value.trim();if(!r||!e){c.alert({title:"작성 오류",message:"제목과 내용을 모두 입력하세요.",type:"error"});return}if(!p.value){c.alert({title:"카테고리 선택",message:"카테고리를 선택해주세요.",type:"error"});return}n.value=!0,d.value="";try{const t=await j({title:r,summary:f.value.trim(),content:e,tags:y.value.split(",").map(s=>s.trim()).filter(Boolean),category:p.value,authorId:g.user.uid,authorName:g.user.email||"user",isPublished:!0});window.dispatchEvent(new CustomEvent("posts-updated")),await M.push(`/posts/${t}`)}catch(t){const s=t?.message||"등록 실패";d.value=s,c.alert({title:"등록 실패",message:s,type:"error"})}finally{n.value=!1}};return(r,e)=>(w(),h("div",Z,[e[9]||(e[9]=a("h1",{class:"text-lg font-semibold text-slate-900 dark:text-slate-100"}," 글 작성 ",-1)),a("div",z,[e[6]||(e[6]=a("span",{class:"text-[11px] text-slate-500 dark:text-slate-300"}," 카테고리 ",-1)),u(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),class:"rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1 text-[11px]"},[(w(),h($,null,O(V,t=>a("option",{key:t,value:t},v(t),9,K)),64))],512),[[J,p.value]])]),a("div",Q,[u(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),placeholder:"제목",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[b,x.value]]),u(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"요약 (선택)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[b,f.value]]),u(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),placeholder:"태그 (쉼표로 구분)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-1"},null,512),[[b,y.value]]),a("div",ee,[a("button",{type:"button",onClick:D,class:"px-3 py-1.5 rounded-md border border-slate-300 text-[11px] text-slate-700 dark:text-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-800"}," 이미지 추가 "),e[7]||(e[7]=a("span",{class:"text-[10px] text-slate-400"}," 업로드하면 본문에 이미지 마크다운이 자동으로 추가됩니다. ",-1)),a("input",{ref_key:"fileInputRef",ref:I,type:"file",accept:"image/*",class:"hidden",onChange:E},null,544)]),u(a("textarea",{ref_key:"contentTextareaRef",ref:_,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value=t),rows:"10",placeholder:"내용 (마크다운 지원, 예: # 제목)",class:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-2 py-2 font-mono",onPaste:H},null,544),[[b,o.value]])]),a("div",te,[a("div",ae,[e[8]||(e[8]=a("div",{class:"text-[10px] text-slate-400"}," 미리보기 ",-1)),a("div",se,[a("button",{type:"button",onClick:S,class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"}," 새로고침 "),a("button",{type:"button",onClick:e[5]||(e[5]=t=>m.value=!m.value),class:"px-2 py-1 rounded border border-slate-300 dark:border-slate-600 text-[10px] hover:bg-slate-100 dark:hover:bg-slate-800"},v(m.value?"접기":"열기"),1)])]),u(a("div",{class:"prose prose-sm max-w-none dark:prose-invert",innerHTML:C.value},null,8,re),[[W,m.value]])]),a("button",{onClick:U,disabled:n.value,class:"px-4 py-2 rounded-md text-[12px] font-semibold bg-black text-white hover:bg-slate-800 disabled:opacity-60 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-300"},v(n.value?"처리 중...":"게시"),9,le),d.value?(w(),h("p",oe,v(d.value),1)):N("",!0)]))}});export{ce as default};
